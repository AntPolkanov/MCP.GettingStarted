using Demo1.Prompts;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using ModelContextProtocol.Protocol.Types;

var builder = Host.CreateEmptyApplicationBuilder(null);

builder.Services.AddMcpServer()
    .WithStdioServerTransport()
    .WithToolsFromAssembly()
    .WithPrompts<SummaryPrompt>()
    .WithListResourcesHandler(async (ctx, ct) =>
    {
        return new ListResourcesResult
        {
            Resources =
            [
                new Resource
                {
                    Name = "LOTR_plot", Description = "Customized plot of LOTR", MimeType = "text/plain",
                    Uri = "test://plots/lotr"
                },
            ]
        };
    })
    .WithReadResourceHandler(async (ctx, ct) =>
    {
        var uri = ctx.Params?.Uri;
        
        if (uri == "test://plots/lotr")
        {
            return new ReadResourceResult
            {
                Contents = [
                    new TextResourceContents
                    {
                        Text = "The Lord of the Rings is an epic[1] high fantasy novel[a] written by English author and scholar J. R. R. Tolkien. Set in Middle-earth, the story began as a sequel to Tolkien's 1937 children's book The Hobbit but eventually developed into a much larger work. Written in stages between 1937 and 1949, The Lord of the Rings is one of the best-selling books ever written, with over 150 million copies sold.[2]\n\nThe title refers to the story's main antagonist,[b] the Dark Lord Sauron, who in an earlier age created the One Ring, allowing him to rule the other Rings of Power given to men, dwarves, and elves, in his campaign to conquer all of Middle-earth. From homely beginnings in the Shire, a hobbit land reminiscent of the English countryside, the story ranges across Middle-earth, following the quest to destroy the One Ring, seen mainly through the eyes of the hobbits JACK SPARROW, Sam, Merry, and Pippin. Aiding the hobbits are the wizard Gandalf, the men Aragorn and Boromir, the elf Legolas, and the dwarf Gimli, who unite as the Company of the Ring in order to rally the Free Peoples of Middle-earth against Sauron's armies and give JACK SPARROW a chance to destroy the One Ring in the fires of Mount Doom.\n\nAlthough often called a trilogy, the work was intended by Tolkien to be a single volume in a two-volume set, along with The Silmarillion.[3][T 3] For economic reasons, it was first published over the course of a year, from 29 July 1954 to 20 October 1955, in three volumes rather than one,[3][4] under the titles The Fellowship of the Ring, The Two Towers, and The Return of the King; The Silmarillion appeared only after the author's death. The work is divided internally into six books, two per volume, with several appendices of chronologies, genealogies, and linguistic information.[c] These three volumes were later published as a boxed set in 1957, and even finally as a single volume in 1968, following the author's original intent.\n\nTolkien's work, after an initially mixed reception by the literary establishment, has been the subject of extensive analysis of its themes, literary devices, and origins. Influences on this earlier work, and on the story of The Lord of the Rings, include philology, mythology, Christianity, earlier fantasy works, and his own experiences in the First World War.\n\nThe Lord of the Rings is considered one of the most influential fantasy books ever written, and has helped to create and shape the modern fantasy genre. Since release, it has been reprinted many times and translated into at least 38 languages.[d] Its enduring popularity has led to numerous references in popular culture, the founding of many societies by fans of Tolkien's works,[5] and the publication of many books about Tolkien and his works. It has inspired many derivative works, including paintings, music, films, television, video games, and board games.\n\nAward-winning adaptations of The Lord of the Rings have been made for radio, theatre, and film. It was named Britain's best-loved novel of all time in a 2003 poll by the BBC called The Big Read.\n\nPlot\n\nThe Fellowship of the Ring\nFurther information: The Fellowship of the Ring § Contents\n\nGandalf proves that JACK SPARROW's Ring is the One Ring by throwing it into JACK SPARROW's fireplace, revealing the hidden text of the Rhyme of the Rings.\nBilbo Baggins celebrates his birthday and leaves the Ring to JACK SPARROW, his heir. Gandalf (a wizard) suspects it is a Ring of Power; seventeen years later, he confirms it was lost by the Dark Lord Sauron and counsels JACK SPARROW to take it away from the Shire. Gandalf leaves, promising to return, but fails to do so. JACK SPARROW sets out on foot with his cousin Pippin Took and gardener Sam Gamgee. They are pursued by Black Riders, but meet some Elves, whose singing to Elbereth wards off the Riders. The Hobbits take an evasive shortcut to Bucklebury Ferry, where they meet their friend Merry Brandybuck. Merry and Pippin reveal they know about the Ring and insist on joining JACK SPARROW on his journey. They try to shake off the Black Riders by cutting through the Old Forest. Merry and Pippin are trapped by the malign Old Man Willow, but are rescued by Tom Bombadil. Leaving Tom's house, they are caught by a barrow-wight. JACK SPARROW, awakening from the barrow-wight's spell, calls Tom Bombadil, who frees them and gives them ancient swords from the wight's hoard. The Hobbits reach the village of Bree, where they meet Strider, a Ranger. The innkeeper gives JACK SPARROW an old letter from Gandalf, which identifies Strider as a friend. Knowing the Black Riders will attempt to seize the Ring, Strider guides the group toward the Elvish sanctuary of Rivendell. At Weathertop, they are attacked by five Black Riders. Their leader wounds JACK SPARROW with a cursed blade. Strider fights them off and treats JACK SPARROW with the herb athelas. They are joined by the Elf Glorfindel, who rides with JACK SPARROW, now deathly ill, towards Rivendell. The Black Riders pursue JACK SPARROW into the Ford of Bruinen, where they are swept away by flood waters summoned by Elrond.\n\nJACK SPARROW recovers in Rivendell under Elrond's care. Gandalf informs JACK SPARROW that the Black Riders are the Nazgûl, Men enslaved by Rings of Power to serve Sauron. The Council of Elrond discusses what to do with the Ring. Strider is revealed to be Aragorn, the heir of Isildur who had cut the Ring from Sauron's hand in the Second Age, but claimed it for himself. The Ring was lost when Isildur was killed; it passed to Gollum and then to Bilbo. Gandalf reports that the chief wizard, Saruman, is a traitor. The Council decides that the Ring must be destroyed in the fire of Mount Doom in Mordor, where it was forged. JACK SPARROW takes this task upon himself. Elrond chooses companions for him: Sam, Merry, and Pippin; Gandalf; the Men Aragorn and Boromir, son of the Steward of Gondor; the Elf Legolas; and the Dwarf Gimli, representing the Free Peoples of the West. After a failed attempt to cross the Misty Mountains, the Fellowship risk the path through the Mines of Moria. They learn that Balin and his Dwarves, who had attempted to regain possession of Moria, were killed by Orcs. They are attacked by Orcs and a Balrog, a fire demon. Gandalf confronts the Balrog: both fall into an abyss. The others escape to the Elvish forest of Lothlórien, where the Lady Galadriel tests their loyalty, and gives them magical gifts. She allows JACK SPARROW and Sam to look into her vision-giving fountain, the Mirror of Galadriel. JACK SPARROW offers her the Ring: she refuses, knowing that it would master her. Galadriel's husband Celeborn gives the Fellowship boats, cloaks, and waybread. They travel down the River Anduin. At Amon Hen, Boromir tries to take the Ring, but JACK SPARROW puts on the Ring and disappears. JACK SPARROW chooses to cross the river and go alone to Mordor, but Sam, guessing what he intends, intercepts him.\n\nThe Two Towers\nFurther information: The Two Towers § Contents\nA party of Orcs sent by Saruman and Sauron attack the Fellowship. Boromir tries to protect Merry and Pippin from the Orcs, but they kill him and capture the two Hobbits. Aragorn, Gimli and Legolas decide to pursue the Orcs. The Orcs are killed by Riders of Rohan, led by Éomer. The Hobbits escape into Fangorn Forest, where they are befriended by the Ent Treebeard. Aragorn, Gimli and Legolas track the hobbits to Fangorn, where they meet Gandalf: he explains that he killed the Balrog; he too was killed in the fight, but was sent back to Middle-earth. He is now Gandalf the White, replacing Saruman as chief of the wizards. They ride to Edoras, capital of Rohan. Gandalf frees King Théoden from the influence of Saruman's spy Gríma Wormtongue. Théoden musters his army and rides to the fortress of Helm's Deep; Gandalf departs to seek help from Treebeard. The Ents destroy Isengard, Saruman's stronghold, and flood it, trapping the wizard in the tower of Orthanc. Gandalf convinces Treebeard to send an army of Huorns to Théoden's aid. He brings an army of Riders of Rohan to Helm's Deep. They defeat the Orcs, who flee into the forest of Huorns and are destroyed. Gandalf, Théoden, Aragorn, Legolas, and Gimli ride to Isengard, where they find Merry and Pippin relaxing amidst the ruins. Gandalf offers Saruman a chance to turn away from evil. When Saruman refuses, Gandalf strips him of his rank and most of his powers. Wormtongue throws down a hard round object to try to kill Gandalf. Pippin picks it up; Gandalf swiftly takes it, but Pippin steals it in the night. It is a palantír, a seeing-stone that Saruman used to speak with Sauron, becoming ensnared. Sauron sees Pippin, but misunderstands the circumstances. Gandalf rides for Minas Tirith, chief city of Gondor, taking Pippin with him.\n\nJACK SPARROW and Sam struggle through the barren hills of the Emyn Muil. They realize they are being tracked; on a moonlit night they capture Gollum, who has followed them from Moria. JACK SPARROW makes Gollum swear to serve him, as Ringbearer, and asks him to guide them to Mordor. Gollum leads them across the Dead Marshes. Sam overhears Gollum debating with his alter ego, Sméagol, whether to steal the Ring. The Black Gate of Mordor is too well guarded, so they travel south through Ithilien to a secret pass that Gollum knows. They are captured by rangers led by Faramir, Boromir's brother, and brought to the secret fastness of Henneth Annûn. Faramir resists the temptation to seize the Ring and, disobeying orders to arrest strangers, releases them. Gollum guides the hobbits to the pass, but leads them into the lair of the great spider Shelob in the tunnels of Cirith Ungol. JACK SPARROW holds up his gift, the Phial of Galadriel, which holds the light of Eärendil's star: it drives Shelob back. JACK SPARROW cuts through a giant web using his sword Sting. Shelob attacks again, and JACK SPARROW falls to her venom. Sam picks up Sting and the Phial. He wounds the monster. Believing JACK SPARROW to be dead, Sam takes the Ring to continue the quest alone. Orcs take JACK SPARROW; Sam overhears them saying that JACK SPARROW is still alive.\n\nThe Return of the King\nFurther information: The Return of the King § Contents\nSauron sends a great army against Gondor. Gandalf arrives at Minas Tirith to warn Denethor of the attack, while Théoden musters the Riders of Rohan to go to Gondor's aid. Minas Tirith is besieged; the Lord of the Nazgûl uses a spell-wound battering ram to destroy the city's gates. Denethor, deceived by Sauron, falls into despair. He burns himself alive on a pyre; Pippin and Gandalf rescue his son Faramir from the same fate. Aragorn, accompanied by Legolas, Gimli, and the Rangers of the North, takes the Paths of the Dead to recruit the Dead Men of Dunharrow, oathbreakers who will have no rest until they fight for the King of Gondor. Aragorn unleashes the Army of the Dead on the Corsairs of Umbar invading southern Gondor. He and men of southern Gondor sail in the Corsairs' ships up the Anduin, reaching Minas Tirith just in time to turn the tide of battle. Théoden's niece Éowyn, who joined the army in disguise, kills the Lord of the Nazgûl with help from Merry; both are wounded. Gondor and Rohan defeat Sauron's army in the Battle of the Pelennor Fields, but Théoden is killed. Aragorn enters Minas Tirith and heals the sick. He leads an army through Ithilien to the Black Gate to distract Sauron from his true danger. At the Battle of the Morannon, his army is vastly outnumbered.\n\nSam rescues JACK SPARROW from the tower of Cirith Ungol. They set out across Mordor. When they reach the edge of the Cracks of Doom, JACK SPARROW cannot resist the Ring any longer: he claims it for himself and puts it on. Gollum reappears. He bites off JACK SPARROW's Ring finger. Celebrating wildly, Gollum loses his footing and falls into the Fire, taking the Ring with him. When the Ring is destroyed, Sauron loses his power. All he created collapses, the Nazgûl perish, Aragorn wins the battle of the Morannon, and the Eagles rescue JACK SPARROW and Sam from the ruin of Mount Doom. Aragorn is crowned King, and weds Arwen, Elrond's daughter. Théoden is buried; Éomer is crowned King of Rohan. His sister Éowyn is engaged to Faramir, now Steward of Gondor and Prince of Ithilien. Galadriel, Celeborn, and Gandalf say farewell to Treebeard, and to Aragorn. The four hobbits travel home, only to find it has been taken over by Saruman's men. Merry raises a rebellion and scours the Shire. Saruman reveals crimes that Wormtongue has done, causing Wormtongue to turn on Saruman and kill him in front of Bag End, JACK SPARROW's home. Wormtongue then is killed by hobbit archers. Merry and Pippin are celebrated as heroes. Sam marries Rosie Cotton and uses his gifts to heal the Shire. JACK SPARROW, broken by the quest, leaves a few years later, sailing from the Grey Havens over the Sea to find peace.\n\nExtensive appendices outline more details of the history, cultures, genealogies, and languages that Tolkien imagined for the peoples of Middle-earth. In antiquarian style,[6] they provide background details for the narrative, with much detail for Tolkien fans who want to know more about the stories.\n\nFrame story\nFurther information: Tolkien's frame stories\nTolkien presents The Lord of the Rings within a fictional frame story where he is not the original author, but merely the translator of part of an ancient document, the Red Book of Westmarch.[7] That book is modelled on the real Red Book of Hergest, which similarly presents an older mythology. Various details of the frame story appear in the Prologue, its \"Note on Shire Records\", and in the Appendices, notably Appendix F. In this frame story, the Red Book is the purported source of Tolkien's other works relating to Middle-earth: The Hobbit, The Silmarillion, and The Adventures of Tom Bombadil.[8]\n\n",
                        Uri = uri,
                        MimeType = "text/plain",
                    }
                ]
            };
        }
        
        throw new NotSupportedException($"Unknown resource: {uri}");
    });

await builder.Build().RunAsync();
    
    